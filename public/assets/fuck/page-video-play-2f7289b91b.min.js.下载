!function(e,a,i,t){function o(a){if(document.getElementsByClassName){var i={controls:!0,autoplay:!1,preload:"metadata",poster:xvideoData.thumb_href,height:440,width:640};c=videojs(e("#h5player")[0],i,function(){c.src(a),n(),c.on("ended",function(){y.clearVideoTipsTransiton(p),E&&e(c.el_).Fads({adsTime:5,name:"FAdsFullScreen",adsurl:E[0].url,passads:!1,containersrc:E[0].path})}),c.on("loadstart",function(){p.append('<p class="p-loading">开始加载视频,请耐心等待....</p>')}),c.on("timeupdate",function(){y.bufferedEnd=c.bufferedEnd(),y.currentTime!=c.currentTime()?(y.currentTime=c.currentTime(),y.timechange=!0,p.hide().html("")):(y.timechange=!1,y.bufferedEnd<=y.currentTime&&(p.html('<p class="p-loading">视频正在缓冲,请耐心等待....</p>'),p.show()))}),c.one("canplay",function(){p.append('<p class="p-loaded">已加载可播放进度,请点击播放....</p>'),e(".vjs-big-play-button").addClass("vjs-big-play-button-active"),y.clearVideoTipsTransiton(p)})}),e(c.el_).append(y.videoTips),p=e(".video-tips"),e(c.el_).Fads({adsTime:null,name:"FAdsLogo",containersrc:"/images/clogoplay.png"}),S&&!xvideoData.is_vip?e(c.el_).Fads({name:"FAdsStop",adsurl:S[0].url,containersrc:S[0].path,width:S[0].width,height:S[0].height,adsTime:null,FAdsStop:!0}):null,S||(e(c.el_).append(e(y.pauseBtn)).find(".FpauseBtn").bind("click",function(){e("#h5player").find("video")[0].play()}),e(c.el_).bind("click.player",function(a){e(a.currentTarget).find("video")[0].paused?e(".video-js .FpauseBtn").addClass("Fshow"):e(".video-js .FpauseBtn").removeClass("Fshow")})),e(c.el_).bind("dblclick.player",function(a){var i=e("button.vjs-fullscreen-control ");i.trigger("click")}),Clipboard&&new Clipboard(".v-button-copy"),e("video").bind("contextmenu",function(){return!1}),c.play()}else l()}function n(){var a=navigator.userAgent.toLowerCase(),i="ipad"==a.match(/ipad/i),t="iphone os"==a.match(/iphone os/i),o="midp"==a.match(/midp/i),n="rv:1.2.3.4"==a.match(/rv:1.2.3.4/i),l="ucweb"==a.match(/ucweb/i),r="android"==a.match(/android/i),d="windows ce"==a.match(/windows ce/i),s="windows mobile"==a.match(/windows mobile/i);return i||t||o||n||l||r||d||s?(e(c.el_).find("video")[0].preload="none",e("video").on("error",function(e){v>0?(e.currentTarget.load(),v--):alert("加载失败，您可以尝试刷新页面！")}),!0):(e("video").on("error",function(e){var a=p.find("p");setTimeout(function(){a.remove()},6e3),p.append('<p class="p-loading">'+y.networkState[c.networkState()]+"....</p>"),p.append('<p class="p-loading">'+y.readyState[c.readyState()]+"....</p>"),p.append('<p class="p-loading">5秒后重新加载视频....</p>'),p[0].scrollTop=p[0].scrollHeight+400,setTimeout(function(){e.currentTarget.load()},5e3)}),!1)}function l(){var e={c:"1",x:"http://"+location.host+"/xml/player/"+xvideoData.video_id,e:"5",v:"80",p:"2",h:"3",lv:"0",my_url:location.host},a={bgcolor:"#FFF",allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"};CKobject.embedSWF("/p/xplayer.swf","xvideo-player","ckplayer_a1","100%","100%",e,a)}function r(a,i,t){var o=parseInt(i)-parseInt(t)>=0,n=layer.open({type:1,title:!1,skin:"v-div-layer",closeBtn:0,shift:0,shadeClose:!0,content:'<div class="v-layui-layer"><div class="v-layui-title"><div class="v-layui-title-right"><span class="xyvideo-icon-times xyvideo-icon layui-layer-close"></span></div></div><div class="v-layui-body v-alyui-body-'+a+' clearfix" style="padding-top: 30px;padding-bottom: 30px;"><div style="font-size:15px;text-align: left"><p>免费下载仅对VIP会员开放，普通会员请支付积分。</p><p>您现有积分：<span style="color: #fc4d51;">'+i+'</span></p><p>需支付积分：<span style="color: #fc4d51;">'+t+'</span></p></div><div style="text-align: left;margin-top: 20px;"><a href="/upgrade" target="_blank" style="height: 35px;line-height: 35px;border: 1px solid #7A46E4;color: #7A46E4;width: 150px;text-align: center;border-radius: 5px;display: inline-block;">开通VIP</a><a class="play-down-points layer-down-enough-'+o+'" style="height: 35px;line-height: 35px;background-color: #7A46E4;color: #fff;width: 150px;text-align: center;margin-left: 25px;border-radius: 5px;">积分下载</a><a href="/my/vip" target="_blank" class="layer-down-enough-show-'+o+'" style="height: 35px;line-height: 35px;background-color: #7A46E4;color: #fff;width: 150px;text-align: center;margin-left: 25px;border-radius: 5px;">充值积分</a></div></div><div class="v-layui-body v-alyui-body-tips-'+a+' clearfix" style="padding-top: 30px;padding-bottom: 30px;"><p style="padding-bottom: 10px;">尊敬VIP会员，下载视频不支持迅雷等加速下载工具以及下载加速，请您使用浏览器下载。</p><a class="play-just-download" style="height: 35px;line-height: 35px;background-color: #23b3ed;color: #fff;padding: 8px 45px;margin-top: 10px;border-radius: 5px;">下载</a></div></div>'});e(".play-down-points").click(function(a){xvideoData.current_credit<xvideoData.download_need_credit?(show_diy_layer("您的积分不足，不允许下载！"),layer.close(n)):e.ajax({url:"/v/get_video_download_url",type:"GET",data:{video_id:e('input[name="video_id"]').val()},dataType:"json"}).done(function(e){layer.close(n),e.result?(window.location.href=e.data,layer.close(n)):show_diy_layer(e.data.message)})}),e(".play-just-download").on("click",function(a){e.ajax({url:"/v/get_video_download_url",type:"GET",data:{video_id:e('input[name="video_id"]').val()},dataType:"json"}).done(function(e){e.result?(window.location.href=e.data,layer.close(n)):show_diy_layer(e.data.message)})})}function d(e){return e.replace(/\s+/g,"")}function s(e){for(var a="";a.length<e&&e>0;){var i=Math.random();a+=.1>i?Math.floor(100*i):String.fromCharCode(Math.floor(26*i)+(i>.5?97:65))}return a}var c=null,v=5,p=null,u={flash_url:"http://"+xvideoData.share_domain+"/p/xplayer.swf?x=http://"+xvideoData.share_domain+"/xml/player/"+xvideoData.video_id,flash_code:'<embed src="http://'+xvideoData.share_domain+'/p/xplayer.swf" flashvars="x=http://'+xvideoData.share_domain+"/xml/player/"+xvideoData.video_id+'" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" allowFullscreen="true" type="application/x-shockwave-flash"></embed>',html5:'<iframe src="http://'+xvideoData.share_domain+"/v/video-iframe?id="+xvideoData.video_id+'" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>'},y={pauseBtn:'<div class="FpauseBtn"><i class="vjs-play-control vjs-paused"></i></div>',videoTips:'<div class="video-tips"><p class="p-show p-install">初始化播放器完毕....</p></div>',currentTime:null,bufferedEnd:null,timechange:!1,networkState:{0:"视频尚未初始化",1:"视频是活动的且已选取资源，但并未使用网络",2:"浏览器正在下载数据",3:"未找到视频来源"},readyState:{0:"没有关于视频是否就绪的信息",1:"关于视频就绪的元数据",2:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",3:"当前及至少下一帧的数据是可用的",4:"可用数据足以开始播放"},clearVideoTipsTransiton:function(e){setTimeout(function(){e.toggle(500,"linear",function(a){e.find("p").remove()})},3e3)},clearVideoTips:function(e){setTimeout(function(){e.find("p").remove()},2e3)}},h=e(".btn-love-it"),f=e(".btn-download-video"),m=e("input.flash-url"),g=e("input.flash-code"),x=e("input.html5-code"),b=e(".btn-share-video"),w=e(".xvideo-video-operation-bar"),T=e(".btn-my-favorite"),k=e(".btn-report-video"),C=e("textarea[maxlength]"),j=e(".btn-sumbmit-comment"),F=e("button.btn-video-play"),D=xvideoData.advertisement.videoSwfBefore,S=xvideoData.advertisement.videoSwfStop,E=xvideoData.advertisement.videoSwfAfter;e(i).on("loadplayer",function(){F.on("click",function(a){(new Fingerprint2).get(function(a,i){var t;t=xvideoData.is_vip?1:0,e.ajax({url:"/v/video_v_href/"+xvideoData.video_id+"?flag="+t+"&fingerprint="+a,type:"GET",dataType:"json",success:function(a){if(a.result)e("div.video-preview").hide(),o(xvideoData.html5_href);else{layer.open({type:1,title:!1,skin:"v-div-layer",closeBtn:0,shift:1,shadeClose:!0,content:'<div class="v-layui-layer"><div class="v-layui-title"><div class="v-layui-title-left"><span class="xyvideo-icon-warning-white xyvideo-icon"></span>提示</div><div class="v-layui-title-right"><span class="xyvideo-icon-times xyvideo-icon layui-layer-close"></span></div></div><div class="v-layui-body clearfix"><label style="display: block;text-align: center;margin-bottom: 30px;color: #333;">对不起你是不VIP,限制每天只能观看3部视频.加入VIP可解锁限制!</label><a href="/upgrade" class="v-button-submit" >怒充VIP</a><a href="/login" class="v-button-cancel">登录</a></div></div>'})}}})})})}),D&&!xvideoData.is_vip&&e.fn.Fads?e("#xvideo-player").Fads({adsTime:30,name:"FAdsFullScreen",adsurl:D[0].url,passads:!0,containersrc:D[0].path,callback:function(){e(i).trigger("loadplayer")}}):e(i).trigger("loadplayer");var A=function(){function a(e){i.comments={total:e.total,items:e.data},i.pagers={from:e.from,current_page:e.current_page,per_page:e.per_page,last_page:e.last_page,to:e.to,isFirst:!e.prev_page_url,isLast:!e.next_page_url},i.trigger("comments_changed",i.comments)}riot.observable(this);var i=this;this.comments=[];var t=function(a,i,t){return e.ajax({url:"/v/video_comments/"+a+"?per_page="+i+"&page="+t,type:"GET",dataType:"json"})},o=function(a){return e.ajax({url:"/v/video_comments/"+a,type:"GET",dataType:"json"})},n=function(a){return e.ajax({url:"/v/comment_inform",type:"POST",data:{comment_id:a}})};i.on("pager_fetch_notFirst",function(e,o,n){t(e,o,n).done(function(e){a(e),i.trigger("pager_changed",i.pagers)})}),i.on("comments_fetch pager_fetch",function(e,t){o(t).done(function(e){a(e),i.trigger("pager_changed",i.pagers)})}),i.on("comment_report",function(e){n(e).done(function(a){a.result?(i.trigger("report_changed",a,e),show_diy_layer("举报成功")):show_diy_layer(a.data.message)})})};h.hover(function(a){if(!e(".btn-love-it").hasClass("active")){var i=e(a.currentTarget).find(".xyvideo-icon");i.attr("class","xyvideo-icon xyvideo-icon-loveit-black")}},function(a){if(!e(".btn-love-it").hasClass("active")){var i=e(a.currentTarget).find(".xyvideo-icon");i.attr("class","xyvideo-icon xyvideo-icon-loveit")}}),h.click(function(a){var i=e(a.currentTarget),t=e(a.currentTarget).find(".xyvideo-icon");i.hasClass("active")?show_diy_layer("已经赞过啦."):e.ajax({url:"/v/video_vote/"+e('input[name="video_id"]').val(),type:"GET",dataType:"json"}).done(function(a){i.addClass("active");var o;a.result&&(o=a.data,e("#xvideo-love-count").text(o),t.attr("class","xyvideo-icon xyvideo-icon-loveit-black"))})}),f.click(function(e){xvideoData.is_vip?r(!1,xvideoData.current_credit,xvideoData.download_need_credit):r(!0,xvideoData.current_credit,xvideoData.download_need_credit)}),m.val(u.flash_url),g.val(u.flash_code),x.val(u.html5),b.on("click",function(a){var i=e(a.currentTarget),t=e(".xvideo-video-operation-bar .v-layui-layer");t.toggleClass("hidden"),i.toggleClass("btn-active")}),w.find(".v-layui-layer .layui-layer-close").on("click",function(a){e(a.currentTarget).closest(".v-layui-layer").toggleClass("hidden"),e(".btn-share-video").toggleClass("btn-active")}),T.hover(function(a){if(!e(".btn-my-favorite").hasClass("active")){var i=e(a.currentTarget).find(".xyvideo-icon");i.attr("class","xyvideo-icon xyvideo-icon-star2")}},function(a){if(!e(".btn-my-favorite").hasClass("active")){var i=e(a.currentTarget).find(".xyvideo-icon");i.attr("class","xyvideo-icon xyvideo-icon-star_outline")}}),T.click(function(a){var i=e(a.currentTarget),t=e(a.currentTarget).find(".xyvideo-icon");i.hasClass("active")?show_diy_layer("已经收藏过了啦, 谢谢!"):e.ajax({url:"/v/video_collection/"+e('input[name="video_id"]').val(),type:"GET",dataType:"json"}).done(function(e){e.result?(show_diy_layer('收藏成功了，亲, 可以到<a href="/my?mycollection=1">个人收藏中心</a>查看.'),i.addClass("active"),t.attr("class","xyvideo-icon xyvideo-icon-star2")):show_diy_layer("出问题了，亲，请稍后在尝试收藏.")})}),k.click(function(a){var i,t=e(a.currentTarget);if(t.hasClass("active"))show_diy_layer("该视频已经举报过啦！正在处理中");else{var o=layer.open({type:1,title:!1,skin:"v-div-layer",closeBtn:0,shift:1,shadeClose:!0,content:'<div class="v-layui-layer"><div class="v-layui-title"><div class="v-layui-title-left"><span class="xyvideo-icon-warning-white xyvideo-icon"></span>请填写你的举报理由</div><div class="v-layui-title-right"><span class="xyvideo-icon-times xyvideo-icon layui-layer-close"></span></div></div><div class="v-layui-body clearfix"><textarea class="v-layui-textarea" ></textarea><div class="v-button-submit">提交</div><div class="v-button-cancel">取消</div></div></div>'});e(".v-button-submit").on("click",function(a){var n=e(".v-layui-textarea").val();if(""!=n){if(d(n).length>150)return show_diy_layer("举报理由太长啦！不能超过150个字"),!1;e.ajax({url:"/v/video_inform",type:"POST",dataType:"json",data:{video_id:e('input[name="video_id"]').val(),comment:n},beforeSend:function(){i=layer.load(1)}}).done(function(e){e.result?(show_diy_layer("举报成功！感谢您的支持"),t.addClass("active"),layer.close(o)):show_diy_layer(e.data.message)}).complete(function(){layer.close(i)})}else show_diy_layer("举报理由不能为空哦")}),e(".v-button-cancel").on("click",function(e){layer.close(o)})}}),C.bind("input propertychange",function(){var a=e(this).attr("maxlength");e(this).val().length>a&&e(this).val(e(this).val().substring(0,a)),e("#current-comment-lenght").text(e(this).val().length)}),j.click(function(a){a.preventDefault();var i=layer.open({type:1,title:!1,skin:"v-div-layer",closeBtn:0,shift:1,shadeClose:!0,content:'<div class="v-layui-layer"><div class="v-layui-title"><div class="v-layui-title-left"><span class="xyvideo-icon-warning-white xyvideo-icon"></span>请输入图片中的验证码</div><div class="v-layui-title-right"><span class="xyvideo-icon-times xyvideo-icon layui-layer-close"></span></div></div><div class="v-layui-body clearfix"><input type="text" class="form-control" name="captcha" placeholder="请输入验证码"><img name="imgCaptcha" src="/captcha/default"></div><div class="v-captcha-submit">提交</div></div>'});return e("img[name=imgCaptcha]").attr("src","/captcha/defult?"+s(10)),e(".v-captcha-submit").on("click",function(a){var t=e("input[name=captcha]").val();""==t?(show_diy_layer("验证码不能为空"),e("img[name=imgCaptcha]").attr("src","/captcha/defult?"+s(10))):(B(t),layer.close(i))}),e("img[name=imgCaptcha]").on("click",function(a){e(a.currentTarget).attr("src","/captcha/defult?"+s(10))}),!1});var B=_.throttle(function(a){var i,t=e(".xvideo-comment-form"),o={cache:!1,type:t.attr("method"),url:t.attr("action"),data:t.serialize()+"&captcha="+a,beforeSend:function(){i=layer.load(1)},success:function(a){a.result?(show_diy_layer("提交评论成功."),RiotControl.trigger("comments_fetch",e('input[name="video_id"]').val()),e(".xvideo-comment-form textarea").val(""),e("#current-comment-lenght").text(0)):show_diy_layer(a.data.message)},complete:function(){layer.close(i)}};t.find("textarea").val()?e.ajax(o):show_diy_layer("评论内容不能为空.")},1e3);e(".xvideo-panel-guessulike ul li").hover(function(a){e(a.currentTarget).find("a.xvideo-thumbnail-mask-video").removeClass("hide")},function(a){e(a.currentTarget).find("a.xvideo-thumbnail-mask-video").addClass("hide")}),RiotControl.addStore(new A),a.mount(e(".xvideo-riot-comments")[0],"rv-vcomments"),a.mount(e(".xvideo-riot-pager")[0],"rv-pager")}($,window.riot,window);